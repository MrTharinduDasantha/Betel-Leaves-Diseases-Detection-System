<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Betel Cultivation Management</title>
    <!-- Add icon to the tab -->
    <link
      rel="icon"
      href="{{ url_for('static', filename='images/logo.png') }}"
      type="image/png"
    />
    <!-- Import the external CSS files -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/common_style.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/cultivation_guide_styles.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/navbar_footer_styles.css') }}"
    />
    <!-- Import Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <!-- Import Quill CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.snow.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="wrapper">
      <!-- Include Navbar -->
      {% include 'navbar.html' %}

      <!-- Message Container for flash messages -->
      <div id="message-container"></div>

      <div class="cultivation-guide-container">
        <!-- Added search bar and most favourite filter section -->
        <div class="search-filter-section">
          <div class="search-bar-wrapper">
            <input
              type="text"
              id="search-input"
              class="search-input"
              placeholder="Search for cultivation guide"
            />
            <button id="search-btn" class="search-btn">
              <i class="fa fa-search"></i>
            </button>
          </div>
          <button id="favourite-filter-btn" class="favourite-filter-btn">
            <i class="fa fa-heart-o"></i>
            <span class="favourite-text"
              >Most Favourite Cultivation Guides</span
            >
          </button>
        </div>

        {% if user and user.role == 'admin' %}
        <!-- Admin View: Editor and Guide Display -->
        <div class="admin-view">
          <!-- Left Side: Display Saved Guides -->
          <div class="guides-display">
            <h3 class="section-title">Cultivation Instructions</h3>
            <div id="guides-list">
              <!-- Guides will be loaded here -->
              {% if guides %} {% for guide in guides %}
              <div class="guide-item" data-id="{{ guide._id }}">
                <h4>{{ guide.title }}</h4>
                <div class="guide-content">{{ guide.content|safe }}</div>
                <div class="guide-meta">
                  <div class="guide-author">
                    Published by: {{ guide.admin_name }}
                  </div>
                  <div class="guide-reactions">
                    <button
                      class="reaction-btn"
                      data-id="{{ guide._id }}"
                      data-reacted="{{ 'true' if guide.user_reacted else 'false' }}"
                    >
                      <i
                        class="fa {{ 'fa-heart' if guide.user_reacted else 'fa-heart-o' }}"
                      ></i>
                      <span class="reaction-count">
                        {% if guide.reaction_count > 0 %} {{
                        guide.reaction_count }} {% endif %}
                      </span>
                    </button>
                  </div>
                </div>
                {% if guide.created_by == session['user_id'] %}
                <div class="guide-actions">
                  <button class="edit-guide-btn" data-id="{{ guide._id }}">
                    <i class="fa fa-edit"></i> Edit
                  </button>
                  <button class="delete-guide-btn" data-id="{{ guide._id }}">
                    <i class="fa fa-trash"></i> Delete
                  </button>
                </div>
                {% endif %}
              </div>
              {% endfor %} {% else %}
              <div class="no-guides">
                <p>No cultivation guides have been added yet.</p>
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Right Side: Quill Editor -->
          <div class="guide-editor">
            <h3 class="section-title">Add/Edit Cultivation Guide</h3>
            <form id="guide-form">
              <div class="form-group">
                <label for="guide-title">Title</label>
                <input
                  type="text"
                  id="guide-title"
                  name="title"
                  placeholder="Enter guide title"
                  required
                />
              </div>
              <!-- Quill editor container -->
              <div id="editor-container">
                <div id="editor"></div>
              </div>
              <!-- Hidden input to store the Quill editor's HTML content -->
              <input type="hidden" name="content" id="guide-content" />
              <input type="hidden" name="guide_id" id="guide-id" />
              <div class="form-actions">
                <button type="button" id="cancel-btn" style="display: none">
                  Cancel
                </button>
                <button type="submit" id="save-btn">Save Guide</button>
              </div>
            </form>
          </div>
        </div>

        {% else %}
        <!-- Farmer View: Display Guides Only -->
        <div class="farmer-view">
          <div class="guides-container">
            {% if guides %} {% for guide in guides %}
            <div class="guide-item">
              <h3 class="guide-title">{{ guide.title }}</h3>
              <div class="guide-content">{{ guide.content|safe }}</div>
              <div class="guide-meta">
                <div class="guide-author">
                  Published by: {{ guide.admin_name }}
                </div>
                <div class="guide-reactions">
                  <button
                    class="reaction-btn"
                    data-id="{{ guide._id }}"
                    data-reacted="{{ 'true' if guide.user_reacted else 'false' }}"
                  >
                    <i
                      class="fa {{ 'fa-heart' if guide.user_reacted else 'fa-heart-o' }}"
                    ></i>
                    <span class="reaction-count"
                      >{% if guide.reaction_count > 0 %} {{ guide.reaction_count
                      }} {% endif %}</span
                    >
                  </button>
                </div>
              </div>
            </div>
            {% endfor %} {% else %}
            <div class="no-guides">
              <p>
                No cultivation guides have been added yet. Please check back
                later.
              </p>
            </div>
            {% endif %}
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Delete Confirmation Modal -->
      <div id="delete-modal" class="modal">
        <div class="modal-content">
          <h3>Confirm Deletion</h3>
          <p>Are you sure you want to delete this cultivation guide?</p>
          <div class="modal-actions">
            <button id="cancel-delete">Cancel</button>
            <button id="confirm-delete">Delete</button>
          </div>
        </div>
      </div>

      <!-- Include Footer -->
      {% include 'footer.html' %}
    </div>

    <!-- Import Quill JS -->
    <script src="https://cdn.jsdelivr.net/npm/quill@2.0.3/dist/quill.js"></script>

    <!-- Import external JS files -->
    <script>
      const currentUserRole = "{{ user.role }}";
    </script>
    <script src="{{ url_for('static', filename='js/cultivation_guide.js') }}"></script>
    <script src="{{ url_for('static', filename='js/common.js') }}"></script>
  </body>
</html>
